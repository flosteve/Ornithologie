{"version":3,"sources":["../../../../../../../src/ObservationBundle/Resources/public/js/Maps/observation.add.js"],"names":["initMap","myLatlng","lat","lng","map","google","maps","Map","document","getElementById","center","zoom","marqueur","Marker","geocoder","Geocoder","infowindow","InfoWindow","iconBaseOiseaux","lat_lng","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","setCenter","handleLocationError","infoWindow","getCenter","input","autocomplete","places","Autocomplete","event","addListener","place","getPlace","geometry","location","$","val","latLng","geocode","results","status","setMap","setIcon","setPosition","LatLng","locationField","address_components","long_name","html","text","setContent","open","window","alert","on","setZoom","marker","browserHasGeolocation","pos","modal"],"mappings":"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","file":"observation.add.js","sourcesContent":["//Initialisation de la map\nfunction initMap()\n{\n    let myLatlng = {lat: 48.866667, lng: 2.333333};\n    let map = new google.maps.Map(document.getElementById('map'),\n        {\n            center: myLatlng,\n            zoom: 8\n        }),\n        marqueur = new google.maps.Marker(),\n        geocoder = new google.maps.Geocoder(),\n        infowindow = new google.maps.InfoWindow(),\n        iconBaseOiseaux = '../../bundles/observation/images/icones/crow_red.png';\n    let lat_lng;\n\n    /*\n     Positionnement de la carte à l'affichage de la Map\n     */\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(function (position) {\n            myLatlng = {\n                lat: position.coords.latitude,\n                lng: position.coords.longitude\n            };\n\n            map.setCenter(myLatlng);\n        }, function () {\n            handleLocationError(true, infoWindow, map.getCenter());\n        });\n    }\n    else {\n        // Browser doesn't support Geolocation\n        handleLocationError(false, infoWindow, map.getCenter());\n    }\n\n    /*\n     Autocomplete du champ input/ récupération des infos\n     */\n    let input = document.getElementById('add_observation_location_lieu');\n    let autocomplete = new google.maps.places.Autocomplete(input);\n\n    google.maps.event.addListener(autocomplete, 'place_changed', function () {\n\n        let place = autocomplete.getPlace();\n        let lat = place.geometry.location.lat(),\n            lng = place.geometry.location.lng();\n\n        $(\"#add_observation_location_latitude\").val(lat);\n        $(\"#add_observation_location_longitude\").val(lng);\n\n    })\n\n    //Création d'un marqueur sur la carte lors d'un clic. Remplissage automatique des champs Lat et Long\n    google.maps.event.addListener(map, 'click', function (event)\n    {\n        lat_lng = {lat: event.latLng.lat(), lng: event.latLng.lng()};\n\n        geocoder.geocode({'location': lat_lng}, function(results, status){\n            if (status === 'OK')\n            {\n                if (results[0])\n                {\n                    marqueur.setMap(map);\n                    marqueur.setIcon(iconBaseOiseaux);\n                    marqueur.setPosition(new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()));\n                    map.setCenter(lat_lng);\n\n                    $(\"#add_observation_location_latitude\").val(event.latLng.lat());\n                    $(\"#add_observation_location_longitude\").val(event.latLng.lng());\n\n                    let locationField = $(\"#add_observation_location_lieu\");\n\n                    locationField.val(results[0].address_components[1].long_name + ', ' + results[0].address_components[2].long_name + ', ' + results[0].address_components[3].long_name + ' ' + results[0].address_components[5].long_name);\n\n\n                    //Affichage des coordonnées\n                    $('#coordinates').html(\"<p><strong>Coordonnées GPS:</strong> Latitude ( \" + event.latLng.lat() + '), Longitude: ( ' + event.latLng.lng() + ').</p>');\n\n                    $(\"#infoPosition\").text(locationField.val());\n                    infowindow.setContent(locationField.val());\n                    infowindow.open(map, marqueur);\n\n                }\n                else\n                {\n                    window.alert('Aucun résultat');\n                }\n            }\n            else\n            {\n                window.alert('Géolocalisation échec: ' + status);\n            }\n        })\n    });\n\n\n//Recupération des coordonées par geolocalisation du user\n\n    $(\"#autoGeo\").on(\"click\", function () {\n\n        // Géolocalisation du user.\n        if (navigator.geolocation)\n        {\n            navigator.geolocation.getCurrentPosition(function(position)\n                {\n                    lat_lng = {lat: position.coords.latitude, lng: position.coords.longitude};\n\n                    geocoder.geocode({'location': lat_lng}, function(results, status){\n                        if (status === 'OK')\n                        {\n                            if (results[0])\n                            {\n                                marqueur.setMap(map);\n                                marqueur.setPosition(lat_lng);\n                                marqueur.setIcon(iconBaseOiseaux);\n                                map.setCenter(lat_lng);\n                                map.setZoom(14);\n\n                                $(\"#add_observation_location_latitude\").val(lat_lng.lat);\n                                $(\"#add_observation_location_longitude\").val(lat_lng.lng);\n                                let locationField = $(\"#add_observation_location_lieu\");\n\n                                locationField.val(results[0].address_components[1].long_name + ', ' + results[0].address_components[2].long_name + ', ' + results[0].address_components[3].long_name + ' ' + results[0].address_components[5].long_name);\n\n                                infowindow.setContent(locationField.val());\n                                infowindow.open(map, marqueur);\n\n                                //Affichage des coordonnées\n                                $('#coordinates').html(\"<p><strong>Coordonnées GPS:</strong> Latitude ( \" + lat_lng.lat + '), Longitude: ( ' + lat_lng.lng + ').</strong></p>');\n                            }\n                            else\n                            {\n                                window.alert('Aucun résultat');\n                            }\n                        }\n                        else\n                        {\n                            window.alert('Géolocalisation échec: ' + status);\n                        }\n                    })\n                },\n                //gestion des erreurs de geolocalisation\n                function() {\n                    handleLocationError(true, marker, map.getCenter());\n                });\n        }\n        else\n        {\n            // Browser doesn't support Geolocation\n            handleLocationError(false, marker, map.getCenter());\n        }\n\n        //Gestion des erreurs de géolocalisation\n        function handleLocationError(browserHasGeolocation, infoWindow, pos)\n        {\n            infoWindow.setPosition(pos);\n            infoWindow.setContent(browserHasGeolocation ?\n                'Error: The Geolocation service failed.' :\n                'Error: Your browser doesn\\'t support geolocation.');\n        }\n    })\n}\n\n//Affihage de la fenêtre modale de la map\n$(\"#locationChoice\").on('click', function () {\n    $('#myModal').modal('show').on('shown.bs.modal', function () {\n        initMap();\n    });\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}