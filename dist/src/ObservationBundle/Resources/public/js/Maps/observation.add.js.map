{"version":3,"sources":["../../../../../../../src/ObservationBundle/Resources/public/js/Maps/observation.add.js"],"names":["initMap","myLatlng","lat","lng","map","google","maps","Map","document","getElementById","center","zoom","marqueur","Marker","geocoder","Geocoder","infowindow","InfoWindow","iconBaseOiseaux","lat_lng","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","setCenter","handleLocationError","infoWindow","getCenter","input","autocomplete","places","Autocomplete","event","addListener","place","getPlace","geometry","location","value","latLng","geocode","results","status","setMap","setIcon","setPosition","LatLng","locationField","address_components","long_name","textContent","setContent","open","window","alert","addEventListener","setZoom","marker","browserHasGeolocation","pos","$","modal","on"],"mappings":"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","file":"observation.add.js","sourcesContent":["//Initialisation de la map\nfunction initMap()\n{\n    let myLatlng = {lat: 48.866667, lng: 2.333333};\n    let map = new google.maps.Map(document.getElementById('map'),\n        {\n            center: myLatlng,\n            zoom: 8\n        }),\n        marqueur = new google.maps.Marker(),\n        geocoder = new google.maps.Geocoder(),\n        infowindow = new google.maps.InfoWindow(),\n        iconBaseOiseaux = '/bundles/observation/images/icones/crow_red.png';\n    let lat_lng;\n\n    /*\n     Positionnement de la carte à l'affichage de la Map\n     */\n    if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(function (position) {\n            myLatlng = {\n                lat: position.coords.latitude,\n                lng: position.coords.longitude\n            };\n\n            map.setCenter(myLatlng);\n        }, function () {\n            handleLocationError(true, infoWindow, map.getCenter());\n        });\n    }\n    else {\n        // Browser doesn't support Geolocation\n        handleLocationError(false, infoWindow, map.getCenter());\n    }\n\n    /*\n     Autocomplete du champ input/ récupération des infos\n     */\n    let input = document.getElementById('add_observation_location_lieu');\n    let autocomplete = new google.maps.places.Autocomplete(input);\n\n    google.maps.event.addListener(autocomplete, 'place_changed', function () {\n\n        let place = autocomplete.getPlace();\n        let lat = place.geometry.location.lat(),\n            lng = place.geometry.location.lng();\n\n        document.getElementById(\"add_observation_location_latitude\").value = lat;\n        document.getElementById(\"add_observation_location_longitude\").value = lng;\n\n    })\n\n    //Création d'un marqueur sur la carte lors d'un clic. Remplissage automatique des champs Lat et Long\n    google.maps.event.addListener(map, 'click', function (event)\n    {\n        lat_lng = {lat: event.latLng.lat(), lng: event.latLng.lng()};\n\n        geocoder.geocode({'location': lat_lng}, function(results, status){\n            if (status === 'OK')\n            {\n                if (results[0])\n                {\n                    marqueur.setMap(map);\n                    marqueur.setIcon(iconBaseOiseaux);\n                    marqueur.setPosition(new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()));\n                    map.setCenter(lat_lng);\n\n                    document.getElementById(\"add_observation_location_latitude\").value = event.latLng.lat();\n                    document.getElementById(\"add_observation_location_longitude\").value = event.latLng.lng();\n\n                    let locationField = document.getElementById(\"add_observation_location_lieu\");\n                    locationField.value = results[0].address_components[2].long_name;\n\n                    document.getElementById(\"infoPosition\").textContent = locationField.value;\n                    infowindow.setContent(results[0].address_components[2].long_name);\n                    infowindow.open(map, marqueur);\n                }\n                else\n                {\n                    window.alert('Aucun résultat');\n                }\n            }\n            else\n            {\n                window.alert('Géolocalisation échec: ' + status);\n            }\n        })\n    });\n\n\n//Recupération des coordonées par geolocalisation du user\n\n    document.getElementById(\"autoGeo\").addEventListener(\"click\", function () {\n\n        // Géolocalisation du user.\n        if (navigator.geolocation)\n        {\n            navigator.geolocation.getCurrentPosition(function(position)\n                {\n                    lat_lng = {lat: position.coords.latitude, lng: position.coords.longitude};\n\n                    geocoder.geocode({'location': lat_lng}, function(results, status){\n                        if (status === 'OK')\n                        {\n                            if (results[0])\n                            {\n\n                                marqueur.setMap(map);\n                                marqueur.setPosition(lat_lng);\n                                marqueur.setIcon(iconBaseOiseaux);\n                                map.setCenter(lat_lng);\n                                map.setZoom(14);\n\n                                document.getElementById(\"add_observation_location_latitude\").value = lat_lng.lat;\n                                document.getElementById(\"add_observation_location_longitude\").value = lat_lng.lng;\n                                document.getElementById(\"add_observation_location_lieu\").value = results[0].address_components[2].long_name;\n\n                                infowindow.setContent(results[0].address_components[2].long_name);\n                                infowindow.open(map, marqueur);\n                            }\n                            else\n                            {\n                                window.alert('Aucun résultat');\n                            }\n                        }\n                        else\n                        {\n                            window.alert('Géolocalisation échec: ' + status);\n                        }\n                    })\n                },\n                //gestion des erreurs de geolocalisation\n                function() {\n                    handleLocationError(true, marker, map.getCenter());\n                });\n        }\n        else\n        {\n            // Browser doesn't support Geolocation\n            handleLocationError(false, marker, map.getCenter());\n        }\n\n        //Gestion des erreurs de géolocalisation\n        function handleLocationError(browserHasGeolocation, infoWindow, pos)\n        {\n            infoWindow.setPosition(pos);\n            infoWindow.setContent(browserHasGeolocation ?\n                'Error: The Geolocation service failed.' :\n                'Error: Your browser doesn\\'t support geolocation.');\n        }\n    })\n}\n\n//Affihage de la fenêtre modale de la map\ndocument.getElementById(\"locationChoice\").addEventListener('click', function () {\n    $('#myModal').modal('show').on('shown.bs.modal', function () {\n        initMap();\n    });\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}