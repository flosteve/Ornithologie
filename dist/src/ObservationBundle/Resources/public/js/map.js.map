{"version":3,"sources":["../../../../../../src/ObservationBundle/Resources/public/js/map.js"],"names":["initMap","marqueur","google","maps","Marker","geocoder","Geocoder","infowindow","InfoWindow","iconBaseOiseaux","lat_lng","myLatlng","map","success","pos","lat","coords","latitude","lng","longitude","Map","document","getElementById","center","zoom","error","err","console","warn","code","message","navigator","geolocation","getCurrentPosition","options","event","addListener","latLng","geocode","results","status","setMap","setIcon","setPosition","LatLng","setCenter","value","locationField","formatted_address","textContent","setContent","open","window","alert","addEventListener","position","setZoom","handleLocationError","marker","getCenter","browserHasGeolocation","infoWindow","$","modal","on"],"mappings":"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","file":"map.js","sourcesContent":["\n//Initilaisation de la map\nfunction initMap()\n{\n\n\n    var marqueur = new google.maps.Marker();\n    var geocoder = new google.maps.Geocoder;\n    var infowindow = new google.maps.InfoWindow;\n    var iconBaseOiseaux = 'http://localhost/NAO/web/bundles/observation/images/icones/crow_red.png';\n    var lat_lng;\n    var myLatlng;\n    var map;\n\n\n    function success(pos) {\n\n        myLatlng = {lat: pos.coords.latitude, lng: pos.coords.longitude};\n\n        map = new google.maps.Map(document.getElementById('map'),\n            {\n                center: myLatlng,\n                zoom: 12\n            });\n    };\n\n    function error(err) {\n        console.warn(`ERROR(${err.code}): ${err.message}`);\n        myLatlng = {lat: 48.866667, lng: 2.333333};\n        map = new google.maps.Map(document.getElementById('map'),\n            {\n                center: myLatlng,\n                zoom: 12\n            });\n    };\n\n    navigator.geolocation.getCurrentPosition(success, error, options);\n\n\n    //Création d'un marqueur sur la carte lors d'un clic. Remplissage automatique des champs Lat et Long\n    google.maps.event.addListener(map, 'click', function (event)\n    {\n         lat_lng = {lat: event.latLng.lat(), lng: event.latLng.lng()};\n\n        geocoder.geocode({'location': lat_lng}, function(results, status){\n            if (status === 'OK')\n            {\n                if (results[0])\n                {\n                    marqueur.setMap(map);\n                    marqueur.setIcon(iconBaseOiseaux);\n                    marqueur.setPosition(new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()));\n                    map.setCenter(lat_lng);\n                    document.getElementById(\"add_observation_location_latitude\").value = event.latLng.lat();\n                    document.getElementById(\"add_observation_location_longitude\").value = event.latLng.lng();\n                    var locationField = document.getElementById(\"add_observation_location_lieu\");\n                    locationField.value = results[0].formatted_address;\n                    document.getElementById(\"infoPosition\").textContent = locationField.value;\n                    infowindow.setContent(results[0].formatted_address);\n                    infowindow.open(map, marqueur);\n                }\n                else\n                {\n                    window.alert('Aucun résultat');\n                }\n            }\n            else\n            {\n                window.alert('Géolocalisation échec: ' + status);\n            }\n        })\n    });\n\n\n//Geolocalisation du user\n\n    document.getElementById(\"autoGeo\").addEventListener(\"click\", function () {\n\n        // Géolocalisation du user.\n        if (navigator.geolocation)\n        {\n            navigator.geolocation.getCurrentPosition(function(position)\n                {\n                    lat_lng = {lat: position.coords.latitude, lng: position.coords.longitude};\n\n                    geocoder.geocode({'location': lat_lng}, function(results, status){\n                        if (status === 'OK')\n                        {\n                            if (results[0])\n                            {\n\n                                marqueur.setMap(map);\n                                marqueur.setPosition(lat_lng);\n                                marqueur.setIcon(iconBaseOiseaux);\n                                map.setCenter(lat_lng);\n                                map.setZoom(14);\n\n                                document.getElementById(\"add_observation_location_latitude\").value = lat_lng.lat;\n                                document.getElementById(\"add_observation_location_longitude\").value = lat_lng.lng;\n                                document.getElementById(\"add_observation_location_lieu\").value = results[0].formatted_address;\n\n                                infowindow.setContent(results[0].formatted_address);\n                                infowindow.open(map, marqueur);\n                            }\n                            else\n                            {\n                                window.alert('Aucun résultat');\n                            }\n                        }\n                        else\n                        {\n                            window.alert('Géolocalisation échec: ' + status);\n                        }\n                    })\n\n                    // marqueur.setMap(map);\n                    // marqueur.setPosition(lat_lng);\n                    // marqueur.setZoom(12);\n                    // marqueur.setIcon(iconBaseOiseaux);\n                    //\n                    // map.setCenter(pos);\n                    // document.getElementById(\"add_observation_location_latitude\").placeholder = pos.lat;\n                    // document.getElementById(\"add_observation_location_longitude\").placeholder = pos.lng;\n                },\n        //gestion des erreurs de geolocalisation\n        function() {\n                    handleLocationError(true, marker, map.getCenter());\n                });\n        }\n        else\n        {\n            // Browser doesn't support Geolocation\n            handleLocationError(false, marker, map.getCenter());\n        }\n\n        //Gestion des erreurs de géolocalisation\n        function handleLocationError(browserHasGeolocation, infoWindow, pos)\n        {\n            infoWindow.setPosition(pos);\n            infoWindow.setContent(browserHasGeolocation ?\n                'Error: The Geolocation service failed.' :\n                'Error: Your browser doesn\\'t support geolocation.');\n        }\n    })\n\n}\n\ndocument.getElementById(\"locationChoice\").addEventListener('click', function () {\n    $('#myModal').modal('show').on('shown.bs.modal', function () {\n        initMap();\n    });\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}