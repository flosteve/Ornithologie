this.App=this.App||{},this.App.Templates=this.App.Templates||{},this.App.Templates.Chat=this.App.Templates.Chat||{},this.App.Templates.Chat=function(){function encodeHTMLSource(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(b){return a[b]||b}):this}}String.prototype.encodeHTML=encodeHTMLSource();var tmpl={};return tmpl.chat=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out="";return view.has_header&&(out+='<div class="chat-header colorable85"><table class=full-width><tr><td class="min"><span class="chat-avatar icon-left">'+view.avatar+'</span></td><td class="relative"><span class="absolute fullscreen"><span class="chat-name middle ellipsis" title="'+encodeHTML(view.title)+'">'+encodeHTML(view.title)+'</span></span></td><td class="min nowrap"><span class="icon-right"><div class="tabbar"><div class="tabbar-content"><ul><li class="only-group"><button type="button" class="tab show-chat-users"><i class="fa fa-user icon-left"></i><span class="user-online-count"></span> / <span class="user-total-count">'+view.user_count+'</span></button></li><li class="only-dm"><button type="button" class="tab button-icon open-air" data-air-users="'+view.airtime_user+'" data-placement="bottom" data-container="body" data-toggle="tooltip" title="'+trans("call_via_airtime")+'"><i class="fa fa-fw fa-video-camera icon-left"></i></button></li><li><button type="button" class="tab button-icon chat-open-detail" data-detail="info"><i class="fa fa-fw fa-info icon-left icon-right"></i></button></li><li><button type="button" class="tab button-icon chat-open-detail" data-detail="search"><i class="fa fa-fw fa-search icon-left icon-right"></i></button></li><li><button type="button" class="tab button-icon chat-open-detail" data-detail="favorites"><i class="fa fa-fw fa-star-o icon-left icon-right"></i></button></li><li><button type="button" class="tab button-icon chat-open-detail" data-detail="links"><i class="fa fa-fw fa-link icon-left icon-right"></i></button></li><li><button type="button" class="tab button-icon chat-open-detail" data-detail="files"><i class="fa fa-fw fa-file-o icon-left icon-right"></i></button></li></ul></div></div></span></td></tr></table></div>'),out+='<div class="chat-body"><div class="chat-messages"><div class="chat-messages-list"></div><table class="full-width margin-top"><tr><td><span class="users-typing"></span></td><td class="nowrap text-right"><span class="inline-block read-stats hidden">'+trans("chat.messge.read_by")+' <span class="read-stats-count"></span> / <span>'+(view.user_count-1)+'</span></span></td></tr></table></div><div class="chat-footer"><div class="chat-footer-inner relative"><table class="full-width"><tr><td class="min top chat-input-controls"><button type="button" class="button button-icon chat-options"><i class="fa fa-fw fa-ellipsis-v"></i></button>\x3c!--<input type="file" name="file" data-button="button-icon" class="chat-upload" multiple="multiple" data-filenameclass="hidden" data-filebuttonhtml="<i class=\'fa fa-fw fa-paperclip\'></i>">--\x3e</td><td><form class="chat-input-form" action="#"><textarea class="text-input chat-input chat-input-empty" placeholder="'+trans("write_message")+'"></textarea></form></td><td class="min top chat-input-controls chat-input-controls-right"></td></tr></table><div class="chat-input-meta hidden">'+trans("enter_to_send.new_line",{keys:'<span class="keyboard">Shift</span> + <span class="keyboard">Enter</span>'})+"</div></div></div></div>"},tmpl.chatActionsMenu=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="content"><ul class="list-menu"><li class="list-menu-item chat-upload-option"><table><tr><td><i class="fa fa-fw fa-paperclip list-menu-icon"></i></td><td>'+trans("chat.post_file")+'<input type=\'file\' class="chat-upload hidden" multiple="multiple"></td></tr></table></li><li class="list-menu-item chat-post-airtime"><table><tr><td><i class="fa fa-fw fa-video-camera list-menu-icon"></i></td><td>'+trans("chat.post_airtime")+"</td></tr></table></li></ul></div>";return out},tmpl.chatChannelItem=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li><div class="chat-menu-item chat-channel reveal-hover" data-channel="'+view.project.project_id+'"><table class="full-width full-height"><tr><td class="min"><span class="icon-left">'+view.avatar+'</span></td><td class="relative"><span class="absolute fullscreen"><span class="channel-name middle ellipsis">'+view.project.name+"</span></span></td></tr></table></div></li>";return out},tmpl.chatContactItem=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li><div class="chat-menu-item chat-contact reveal-hover" data-user="'+view.user.user_id+'"><label><table class="full-width full-height"><tr><td class="min contact-select hidden"><span class="icon-left"><input type="checkbox"></span></td><td class="min"><span class="icon-left">'+App.Util.avatar(view.user.user_id,{customClass:"avatar-l",status:!0,html:!0,tooltip:!1})+'</span></td><td class="relative"><span class="absolute fullscreen"><span class="user-name middle ellipsis">'+view.user.display_name+"</span></span></td></tr></table></label></div></li>";return out},tmpl.chatGroupContacts=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<ul class="list list-simple list-scrollable" data-shadow="true" data-search-input>',arr1=view.users;if(arr1){var user,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,user=arr1[i1],out+='<li><div class="chat-group-contact" data-user="'+user.user_id+'"><label><table class="full-width full-height"><tr>',(view.chat||view.airtime)&&(out+='<td class="min"><input type="checkbox" class="icon-left',user.isSelf()&&(out+=" invisible"),out+='"',user.isSelf()&&(out+=' disabled="disabled"'),out+="></td>"),out+='<td class="min">'+App.Util.avatar(user.user_id,{customClass:"avatar",status:!0,html:!0,tooltip:!1})+"</td><td><span>"+user.display_name+"</span></td></tr></table></label></div></li>"}return out+="</ul>",(view.chat||view.airtime)&&(out+='<div class="controls"><table class="full-width"><tr>',view.chat&&(out+='<td><button type="button" class="button button-primary start-chat full-width dismiss" disabled><i class="fa fa-comments icon-left"></i>Chat</button></td>'),view.airtime&&(out+='<td><span class="icon-right full-width"><button type="button" class="button start-airtime full-width dismiss" disabled><i class="fa fa-video-camera icon-left"></i>AirTime</button></span></td>'),out+="</tr></table></div>"),out},tmpl.chatIntro=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="chat-intro"><div class="chat-intro-icon"><i class="fa fa-comments-o"></i></div><div class="chat-intro-body"><div class="chat-intro-title">';return view.can_edit_name?out+='<table class="full-width"><tr><td></td><td class="text-meta padding-bottom-small"><i class="fa fa-pencil icon-left"></i>'+trans("name_chat")+'</td></tr><tr><td class="min"><span class="icon-left">'+view.avatar+'</span></td><td><textarea class="chat-intro-title-name" spellcheck="false" rows="1">'+encodeHTML(view.title)+"</textarea></td></tr></table>":out+='<span class="icon-left">'+view.avatar+'</span><span class="chat-intro-title-name">'+encodeHTML(view.title)+"</span>",out+='</div><div class="chat-intro-info">'+view.info+"</div></div></div>"},tmpl.chatIntroChannel=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out=trans("chat.intro.channel")+'<br><br><table><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-comments-o icon-left"></i></td><td>'+trans("chat.intro.channel.discussion")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-files-o icon-left"></i></td><td>'+trans("chat.intro.channel.files")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-link icon-left"></i></td><td>'+trans("chat.intro.channel.links")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-smile-o icon-left"></i></td><td>'+trans("chat.intro.channel.emojis")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-search icon-left"></i></td><td>'+trans("chat.intro.channel.search")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-envelope-o icon-left"></i></td><td>'+trans("chat.intro.channel.no_email")+'</td></tr><tr class="chat-intro-feature"><td><i class="fa fa-fw fa-group icon-left"></i></td><td>'+trans("chat.intro.channel.collaboration")+"</td></tr></table>";return out},tmpl.chatLayout=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="chat-container"><div id="chat-panel"><div id="chat-panel-header" class="reveal-hover colorable"><table class="full-width"><tr><td class="min">'+view.avatar+'</td><td class="user-info"><table class="full-width line-height-normal"><tr><td class="relative"><div class="absolute fullscreen"><span class="ellipsis user-name" title="'+view.username+'">'+view.username+'</span></div></td></tr><tr><td class="relative"><div class="absolute fullscreen"><span class="ellipsis account-name" title="'+view.account+'"><a href="'+view.account_url+'" target="_blank">'+view.account+'</a></span></div></td></tr></table></td>\x3c!--<td class="min">--\x3e\x3c!--<div class="on-hover">--\x3e\x3c!--<button type="button" class="control-light blue"><i class="fa fa-fw fa-caret-down"></i></button>--\x3e\x3c!--</div>--\x3e\x3c!--</td>--\x3e</tr></table></div><div id="chat-panel-body" class="list-bottom-offset"><ul><li><span class="chat-panel-entry chat-panel-menu-item" data-menu="channels"><table class="full-width"><tr><td class="min"><span class="icon-left"><i class="fa fa-fw fa-hashtag"></i></span></td><td>'+trans("chat.channels")+'</td><td class="min"><span class="icon-right"><i class="fa fa-fw fa-angle-right"></i></span></td></tr></table></span></li><li><span class="chat-panel-entry chat-panel-menu-item" data-menu="contacts"><table class="full-width"><tr><td class="min"><span class="icon-left"><i class="fa fa-fw fa-group"></i></span></td><td>'+trans("chat.contacts")+'</td><td class="min"><span class="icon-right"><i class="fa fa-fw fa-angle-right"></i></span></td></tr></table></span></li></ul><div class="chat-panel-section">'+trans("recents")+'</div><ul id="chat-list-items" class=""></ul><div class="chat-panel-entry margin-top chat-toggle-old"><span class="avatar avatar-l"><i class="fa fa-fw fa-clock-o"></i></span><span class="chat-show-old-label">'+trans("chat.show_old")+'</span><span class="chat-show-old-label hidden">'+trans("chat.hide_old")+'</span></div></div></div><div id="chat-menu"><div class="chat-menu" id="chat-menu-channels"><div class="box-margin-big"><input type="text" class="input text-input chat-menu-search full-width" placeholder="'+trans("rechercher_input")+'..."></div><ul class="chat-channels list-bottom-offset"></ul></div><div class="chat-menu" id="chat-menu-contacts"><div><button class="button-bare button-chat chat-multiple-contact"><i class="fa fa-plus icon-left"></i>'+trans("chat.create_group")+'</button></div><div><button class="button-bare button-green button-chat hidden chat-create-chat" disabled="disabled"><i class="fa fa-check icon-left"></i>'+trans("chat.create_group.confirm")+'</button></div><div class="box-margin-big"><input type="text" class="input text-input chat-menu-search full-width" placeholder="'+trans("rechercher_input")+'..."></div><ul class="chat-contacts list-bottom-offset"></ul></div></div><div id="chat-main"><div id="chat-home"><div class="chat-header colorable"></div><div class="chat-body vertical-box text-center"><div class="vertical-box-inner"><div class="chat-home-icon colorable-text"><i class="fa fa-comments-o"></i></div><div class="chat-home-info"><div class="title colorable-text">'+trans("product")+' <span class="bold">Chat</span></div><div>'+trans("chat.home.message")+"</div></div></div></div></div></div></div>";return out},tmpl.chatListItem=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li class="reveal-hover chat-list-item'+(view.chat.isOlderThan(view.days_until_old)?" chat-old":"")+'" data-chat="'+view.chat.chat_id+'" title="'+view.chat.getTitle()+'"><div class="chat-panel-entry"><table class="full-width"><tr><td class="min">'+view.avatar+'</td><td class="relative full-width"><span class="absolute fullscreen"><span class="middle ellipsis">'+encodeHTML(view.chat.getTitle())+'</span></span></td><td class="min"><span class="unread-count tag orange" data-count="'+view.chat.new_count+'"></span></td><td class="min on-hover"><span class="icon-right"><button type="button" class="control-light button-icon chat-disable"><i class="fa fa-fw fa-remove"></i></button></span></td></tr></table></div></li>';return out},tmpl.detail_chat_favorites=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("favorites")+'</span></td><td class="min nowrap"><button class="control-light refresh-data" data-toggle="tooltip" title="'+trans("reload")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-refresh"></i></button><button class="control-light close-panel" data-toggle="tooltip" title="'+trans("close")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-remove"></i></button></td></tr></table></div><div class="chat-favorites list-bottom-offset"></div></div>';return out},tmpl.detail_chat_files=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("attachments")+'</span></td><td class="min nowrap"><input type="file" name="file" data-button="button button-primary" class="chat-add-attachment" multiple="multiple" data-filenameclass="hidden" data-filebuttonhtml="<i class=\'fa fa-file-o icon-left super-plus\'></i>'+trans("add_files")+'"><button class="control-light refresh-data middle" data-toggle="tooltip" title="'+trans("reload")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-refresh"></i></button><button class="control-light close-panel middle" data-toggle="tooltip" title="'+trans("close")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-remove"></i></button></td></tr></table></div></div><div class="panel-section"><div class="chat-files list-bottom-offset"></div></div>';return out},tmpl.detail_chat_info=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("informations")+'</span></td><td class="min nowrap"><button class="control-light close-panel" data-toggle="tooltip" data-container="#chat-main" title="'+trans("close")+'" type="button"><i class="fa fa-fw fa-remove"></i></button></td></tr></table></div><div class="property property-block"><span class="property-value"><table class="full-width"><tr><td class="min"><i class="fa fa-fw fa-pencil icon-left"></i></td><td><input type="text" class="input text-input full-width" name="name" placeholder="'+trans("name")+'" data-container="body"';return view.can_edit_name||(out+=' readonly="readonly" disabled="disabled"'),out+='></td></tr></table></span></div></div><div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("users").toUpperFirst()+"</span></td>",view.can_add_users&&(out+='<td class="min nowrap"><button class="button button-link button-blue add-chat-users" type="button"><i class="fa fa-fw fa-user-plus icon-left"></i>'+trans("add")+"</button></td></tr>"),out+='</table></div><div class="property property-block"><span class="property-name"></span><span class="property-value"><ul class="list list-scrollable chat-user-list"></ul></span></div></div>'},tmpl.detail_chat_links=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("links")+'</span></td><td class="min nowrap"><button class="control-light refresh-data" data-toggle="tooltip" title="'+trans("reload")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-refresh"></i></button><button class="control-light close-panel" data-toggle="tooltip" data-container="#chat-main" title="'+trans("close")+'" type="button"><i class="fa fa-fw fa-remove"></i></button></td></tr></table></div><div class="chat-links list-bottom-offset"></div></div>';return out},tmpl.detail_chat_search=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section"><div class="panel-section-title"><table class="full-width"><tr><td><span class="panel-title">'+trans("search")+'</span></td><td class="min nowrap"><button class="control-light close-panel" data-toggle="tooltip" title="'+trans("close")+'" data-container="#chat-main" type="button"><i class="fa fa-fw fa-remove"></i></button></td></tr></table></div><form class="chat-search-form" action="#"><table class="table-input full-width"><tr><td class="full-width"><input class="text-input chat-search-input" placeholder="'+trans("chat.search.input")+'"></td><td><button class="button button-primary button-icon chat-search-button" type="submit"><i class="fa fa-fw fa-search"></i></button></td></tr></table></form></div><div class="panel-section"><div class="no-results hidden"></div><ul class="chat-search-results list-bottom-offset"></ul></div>';return out},tmpl.editMessage=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="content"><div class="property property-block"><div class="property-value"><table class="full-width"><tr><td><textarea autofocus class="text-input full-width" name="content" required>'+view.content+'</textarea></td><td class="min top"><div class="icon-right"><div id="edit-message-emoji-picker"></div></div></td></tr></table></div></div></div><div class="controls">';return view.can_delete&&(out+='<div class="float-left"><button type="button" class="button button-icon button-red message-delete" data-toggle="tooltip" title="'+trans("supprimer").toUpperFirst()+'"><i class="fa fa-fw fa-trash-o"></i></button></div>'),out+='<div class="float-right"><button type="button" class="button dismiss">'+trans("cancel")+'</button><button type="button" class="button button-accept message-edit">'+trans("edit").toUpperFirst()+'</button></div><div class="clear"></div></div>'},tmpl.uploadAttachment=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div class="title-bar">'+trans("file_add")+" ";return view.file_count>1&&(out+="("+view.file_index+"/"+view.file_count+")"),out+='</div><div class="content"><div class="property property-block attachment-preview">',view.src?out+='<img src="'+view.src+'">':out+=""+view.icon,out+='</div><div class="property property-block"><div class="property-value"><input class="text-input full-width bold" autofocus value="'+view.title+'" name="title"></div></div><div class="property property-block attachment-preview"><div class="property-value"><textarea class="text-input full-width" name="description" data-dynamic="true" placeholder="'+trans("description")+'"></textarea></div></div></div><div class="controls"><div class="float-right">',view.file_count>1&&(out+='<button type="button" class="button cancel-all dismiss">'+trans("cancel_all")+" ("+(view.file_count-view.file_index+1)+")</button>"),out+='<button type="button" class="button cancel dismiss">'+trans("cancel")+'</button><button type="submit" class="button button-accept">'+trans("confirm")+'</button></div><div class="clear"></div></div></form>'},tmpl}();var App;!function(a){!function(b){!function(b){function c(){console.log("routing js /chat"),a.Global.module(a.Global.MODULES.CHAT),d(a.Script.Chat.init)}function d(b){$("#chat-container").remove();var c=a.Global.user(),d=a.Util.avatarFor(c,{html:!0,status:!0,tooltip:!1,customClass:"avatar-l colorable-status-background"}),e={account_url:a.Global.url("",!1),avatar:d,account:a.Global.getCompanyName(),username:c.display_name},f=a.Global.viewLoaded($(a.Templates.Chat.chatLayout(e)));$("body").prepend(f),b(f,e)}b.chat=c}(b.Chat||(b.Chat={}))}(a.Controller||(a.Controller={}))}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){var b=function(b){function d(e,f,g,h){void 0===h&&(h={});var i=d.idFor(e.chat_id);b.call(this,i,f,h),this.chat=e,this.chatOptions=g;var j=this;this.aLinkMessages=null,this.aFavorites=null,this.aFiles=null,this.addTab("info","info",a.Templates.Chat.detail_chat_info({can_edit_name:!this.chat.isChannel(),can_add_users:!this.chat.isChannel()}),{onLoaded:function(b){b.on("change","input[name=name]",function(){var b=$(this),c=b.val();a.API.Chat.editName(j.chat.chat_id,c,{tooltip:b})}).on("click",".add-chat-users",function(){var b=$(this),c=a.Global.fellowUsers(!1),d=j.chat.getUsersId();c=c.filter(function(a){return-1===$.inArray(a.user_id,d)}),a.Global.showUserPicker(c,function(c){var d=c.map(function(a){return a.user_id});a.API.Chat.addUsers(j.chat.chat_id,d,{button:b})},{title:a.Global.trans("contributeurs"),actionLabel:a.Global.trans("add"),canCreate:!1,popopver:{trigger:b,options:{container:"#chat-container",placement:"left"}},selectAll:!0})}).on("click",".remove-chat-user",function(){var b=$(this),c=parseInt(b.closest("[data-user]").data("user"));a.Popup.confirm(null,a.Global.trans("really_sure_del"),{popover:{trigger:b,options:{placement:"left",container:"#chat-container"}}},a.Global.trans(c==a.Global.user().user_id?"leave_chat":"remove").toUpperFirst(),{type:a.Util.ButtonType.RED},function(d){a.API.Chat.removeUsers(j.chat.chat_id,[c],{button:b}),a.Popup.hide(d)})})}}).addTab("search","search","",{onLoaded:function(a){j.search||(j.search=new c(j.chat,a)),j.search.$searchInput.focus()}}).addTab("favorites","star-o",a.Templates.Chat.detail_chat_favorites(),{onLoaded:function(b,c){var d=function(){var d=b.find(".chat-favorites");a.API.Chat.getFavorites(j.chat.chat_id,{onSuccess:function(b){var c=new a.API.Chat.Chat.GetFavoritesResponse(b);j.aFavorites=c.favorites.sort(function(a,b){return a.date.isBefore(b.date)?1:-1}),j.aFavorites.length?(d.html(a.Chat.viewForMessages(j.aFavorites,null,j.chat.favorites,{hideAirTime:!0,hideChat:!0})),a.Chat.messagesViewLoaded(d)):d.html('<div class="no-results">'+a.Global.trans("chat.no_favorites")+"</div>")},button:c.find("button").add(".panel-title",b)})};null===j.aFavorites&&(j.aFavorites=[],d(),b.find(".refresh-data").click(function(){d()}))}}).addTab("links","link",a.Templates.Chat.detail_chat_links(),{onLoaded:function(b,c){var d=function(){var d=b.find(".chat-links");a.API.Chat.getLinks(j.chat.chat_id,{onSuccess:function(b){var c=new a.API.Chat.Chat.GetLinksResponse(b);j.aLinkMessages=c.links.sort(function(a,b){return a.date.isBefore(b.date)?1:-1}),j.aLinkMessages.length?(d.html(a.Chat.viewForMessages(j.aLinkMessages,null,j.chat.favorites,{hideAirTime:!0,hideChat:!0})),a.Chat.messagesViewLoaded(d)):d.html('<div class="no-results">'+a.Global.trans("chat.no_links")+"</div>")},button:c.find("button").add(".panel-title",b)})};null===j.aLinkMessages&&(j.aLinkMessages=[],d(),b.find(".refresh-data").click(function(){d()}))}}).addTab("files","file-o",a.Templates.Chat.detail_chat_files(),{onLoaded:function(b,c){var d=function(){var d=b.find(".chat-files");a.API.Chat.getAttachements(j.chat.chat_id,{onSuccess:function(b){var c=new a.API.Chat.Chat.GetAttachmentListResponse(b);j.aFiles=c.attachments.sort(function(a,b){return a.date.isBefore(b.date)?1:-1}),j.aFiles.length?(d.html(a.Chat.viewForMessages(j.aFiles,null,j.chat.favorites,{hideAirTime:!0,hideChat:!0})),a.Chat.messagesViewLoaded(d)):d.html('<div class="no-results">'+a.Global.trans("chat.no_attachments")+"</div>")},button:c.find("button").add(".panel-title",b)})};null===j.aFiles&&(j.aFiles=[],d(),b.find(".refresh-data").click(function(){d()}),b.on("change",".chat-add-attachment",function(){var a=$(this),b=(a.siblings(".action").first(),a[0]),c=b.files;j.chatOptions.addFiles(c),a.val("")}))}}),this.bind(),this.setName(),this.setUsers()}return __extends(d,b),d.prototype.bind=function(){},d.prototype.setName=function(){this.$panel.find('input[name="name"]').val(this.chat.getTitle())},d.prototype.setUsers=function(){var b=this.chat.isChannel(),c=this.$panel.find(".chat-user-list"),d=this.chat.getUsers().map(function(c){var d=c.user_id==a.Global.user().user_id;return c?'<li data-user="'+c.user_id+'" class="reveal-hover line-height-button"><table class="full-width"><tr><td class="min"><span class="avatar">'+c.getInitials()+"</span></td><td>"+c.display_name+"</td>"+(b?"":'<td class="min"><button class="button button-link button-red remove-chat-user'+(d?"":" on-hover")+'">'+a.Global.trans(d?"leave_chat":"remove")+"</span></button></td>")+"</tr></table></li>":""}).join("");a.Global.viewLoaded(c.html(d))},d.idFor=function(a){return"file-"+a},d.panelFor=function(b){var c=a.Panel.getPanel(d.idFor(b));return c||null},d}(a.Panel);a.ChatPanel=b;var c=function(){function b(b,c){this.chat=b,this.$container=c;var d=a.Templates.Chat.detail_chat_search();a.Global.viewLoaded(this.$container.html(d)),this.$searchInput=this.$container.find(".chat-search-input"),this.$searchForm=this.$container.find(".chat-search-form"),this.$resultList=this.$container.find(".chat-search-results"),this.$noResults=this.$container.find(".no-results"),this.bind()}return b.prototype.bind=function(){var b=this;this.$searchForm.on("submit",function(){var c=b.$searchInput.val();if(!c)return b.resetResults();var d=b.$searchForm.find(".chat-search-button");a.API.Chat.search(b.chat.chat_id,c,{onSuccess:function(d){var e=new a.API.Chat.Chat.SearchResponse(d),f=e.results;b.displayResults(f,c)},button:d})}),this.$resultList.on("click",".search-result-expand",function(){var a=$(this).closest(".search-result"),c=a.is(".search-result-expanded");if(a.toggleClass("search-result-expanded"),!c){var d=a.get(0).offsetTop;b.$container.closest(".panel-content").scrollTo(d,300)}})},b.prototype.displayResults=function(c,d){if(!c.length)return this.noResults(d);this.$noResults.html("").addClass("hidden");var e="";for(var f in c)if(c.hasOwnProperty(f)){var g=c[f],h=g.message;e+='<li class="search-result"><table class="full-width"><tr><td><div class="search-context-messages">'+a.Chat.viewForMessages(g.before,null,this.chat.favorites,{hideAirTime:!0,hideChat:!0})+"</div>"+a.Chat.viewForMessages([h],null,this.chat.favorites,{hideAirTime:!0,hideChat:!0})+'<div class="search-context-messages">'+a.Chat.viewForMessages(g.after,null,this.chat.favorites,{hideAirTime:!0,hideChat:!0})+'</div></td><td class="min top"><span class="icon-right"><button class="control-light search-result-expand" type="button"><i class="fa fa-fw"></i></button></span></td></tr></table></li>'}var i=$(e);b.highlightSearchedText(d,i),a.Chat.messagesViewLoaded(i),this.$resultList.html(i)},b.prototype.resetResults=function(){this.$resultList.html(""),this.$noResults.html("").addClass("hidden")},b.prototype.noResults=function(b){this.$resultList.html("");var c="<strong>"+$("<div></div>").text(b).html()+"</strong>";this.$noResults.html(a.Global.trans("chat.search.no_result",{search:c})).removeClass("hidden")},b.highlightSearchedText=function(b,c){c.find(".message").each(function(){var c=$(this),d=c.find(".content");d.html(a.Util.wrapText(d.html(),b,"search-match",!0))})},b}()}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){!function(b){!function(c){!function(c){function d(b,c){if(e[b]&&e[b][c.index])return void console.warn("double message detected",c,b);e[b]=e[b]||{},e[b][c.index]=c,a.Script.Chat.onNewMessage(b,c)}var e={},f=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){c.isCaller()||a.Script.Chat.onChatCreated(b.chat_id)},c}(b.Action);c.create=f;var g=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){c.isCaller()||a.Script.Chat.onChatCreated(b.chat_id)},c}(b.Action);c.createChannel=g;var h=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onNameEdited(b.chat_id,b.name)},c}(b.Action);c.editName=h;var i=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onUsersAdded(b.chat_id,b.added_user_id_list,b.chat_users)},c}(b.Action);c.addUsers=i;var j=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){-1!==$.inArray(a.Global.user().user_id,b.removed_user_id_list)?a.Script.Chat.onChatLeft(b.chat_id):a.Script.Chat.onUsersRemoved(b.chat_id,b.removed_user_id_list,b.chat_users)},c}(b.Action);c.removeUsers=j;var k=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.onMessage=function(a,b){d(a.chat_id,a.message)},b}(b.Action);c.postMessage=k;var l=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.onMessage=function(a,b){d(a.chat_id,a.message)},b}(b.Action);c.addAttachment=l;var m=function(b){function c(){b.apply(this,arguments)}
return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onMessageEdited(b.chat_id,b.message)},c}(b.Action);c.editMessage=m;var n=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onMessageDeleted(b.chat_id,b.message)},c}(b.Action);c.deleteMessage=n;var o=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onMessageSetFavorite(b.chat_id,b.message_index,!0)},c}(b.Action);c.favoriteMessage=o;var p=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onMessageSetFavorite(b.chat_id,b.message_index,!1)},c}(b.Action);c.unfavoriteMessage=p;var q=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onUnseenCleared(b.chat_id,b.user_id)},c}(b.Action);c.clearUnseen=q;var r=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onChatDisabled(b.chat_id)},c}(b.Action);c.disable=r;var s=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onUserStartedTyping(b.chat_id,b.user_id)},c}(b.Action);c.startedTyping=s;var t=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Script.Chat.onUserStoppedTyping(b.chat_id,b.user_id)},c}(b.Action);c.canceledTyping=t}(c.Chat||(c.Chat={}))}(b.Chat||(b.Chat={}))}(a.Push||(a.Push={}))}(App||(App={}));var App;!function(a){!function(b){b.Chat={"":a.Controller.Chat.chat,":options":a.Controller.Chat.chat}}(a.Routes||(a.Routes={}))}(App||(App={}));var App;!function(a){!function(b){!function(b){function c(b,c){C=b,E={},D={},G.init(),H.init(),e(function(){if(f.chat)k(f.chat),a.Global.routeOption("chat",null);else if(f.channel)H.createChannel(f.channel),a.Global.routeOption("channel",null);else if(f.users){var b=f.users.split(",");G.createChat(b,!0),a.Global.routeOption("users",null)}}),d();var f=a.Global.getRouteOptions();B=new a.DropZone(C,function(){for(var a in E)if(E.hasOwnProperty(a)&&E[a]&&E[a].isVisible())return!0;return!1},function(a){for(var b in E)E.hasOwnProperty(b)&&E[b]&&E[b].isVisible()&&E[b].uploadAttachments(a)})}function d(){C.on("click",".chat-list-item:not(.active)",function(){h($(this).data("chat"))}).on("click",".chat-list-item .chat-disable",function(b){b.stopPropagation();var c=$(this),d=c.closest(".chat-list-item"),e=d.data("chat");a.Popup.confirm(null,a.Global.trans("chat.disable_confirm"),{popover:{trigger:c,options:{container:"body"}}},a.Global.trans("confirm"),{type:"button-red"},function(b){a.Popup.hide(b),a.API.Chat.disbaleChat(e,{button:c})})}).on("click",".chat-panel-menu-item",function(){var a=$(this);a.is(".active")?g():f(a.data("menu"))}).on("click",".chat-toggle-old",function(){C.find("#chat-list-items").toggleClass("show-old-chats"),$(this).find(".chat-show-old-label").toggleClass("hidden")})}function e(b){var c=$("#chat-panel");a.API.Chat.getChats({onSuccess:function(d){var e=new a.API.Chat.Chat.GetListResponse(d),f=a.Global.projects(),g=f.map(function(a){return a.project_id}),h=e.chats.filter(function(a){return!a.project_id||-1!==$.inArray(a.project_id,g)}).sort(function(a,b){return b.last_message_date.diff(a.last_message_date)});for(var i in h)if(h.hasOwnProperty(i)){var j=h[i];D[j.chat_id]=j}var k=c.find("#chat-list-items"),l=k.find(".chat-list-item.active").data("chat"),m="";for(var i in h)if(h.hasOwnProperty(i)){var n=h[i],o=a.Chat.chatAvatar(n);m+=a.Templates.Chat.chatListItem({chat:n,avatar:o,days_until_old:F})}a.Global.viewLoaded(k.html(m)),A(),l&&k.find('.chat-list-item[data-chat="'+l+'"]').addClass("active"),b&&b()}})}function f(a){var b=$("#chat-menu");C.find(".chat-panel-menu-item").removeClass("active").filter('[data-menu="'+a+'"]').addClass("active"),b.addClass("active").find(".chat-menu").removeClass("active").filter("#chat-menu-"+a).addClass("active").find(".chat-menu-search").focus()}function g(){var a=$("#chat-menu");C.find(".chat-panel-menu-item").removeClass("active"),a.find(".chat-menu").removeClass("active"),a.removeClass("active")}function h(b){var c=C.find("#chat-main");C.find(".chat-list-item").removeClass("active").filter('[data-chat="'+b+'"]').addClass("active");for(var d in E)if(E.hasOwnProperty(d)){var e=E[d];e.hide()}var f=E[b];f?f.show():(f=new a.Chat(b,{startChat:function(a){var b=f.$chat.find(".show-chat-users");G.createChat(a,!0,b)},startAirtime:function(b){a.Communication.openAirTime({users:b})},onLoadError:function(){return f.$chat.remove(),E[b]=null,delete E[b],!1}}),E[b]=f,c.append(f.$chat))}function i(a,b){var c=D[a];if(c){c.new_count=b;C.find('.chat-list-item[data-chat="'+a+'"]').find(".unread-count").attr("data-count",c.new_count)}}function j(a){var b=E[a];return b&&b.isActive()}function k(a){D[a]?h(a):e(function(){h(a)})}function l(b,c){var d=a.Lib.Tabs.hasFocus(),f=D[b];if(f){var g=E[b],h=c.user_id==a.Global.user().user_id,j=g&&g.isActive(),k=!h&&!j;g&&g.onNewMessage(c);C.find('.chat-list-item[data-chat="'+b+'"]').removeClass("chat-old").insertAtIndex(C.find("#chat-list-items"),0),A(),k&&(i(b,f.new_count+1),d&&(console.log("play sound: chat.message"),$.ionSound.play("chat.message")))}else e(d?function(){console.log("play sound: chat.message"),$.ionSound.play("chat.message")}:null)}function m(a,b){if(D[a]){var c=E[a];c&&c.onMessageEdited(b)}}function n(a,b){if(D[a]){var c=E[a];c&&c.onMessageDeleted(b)}}function o(a,b,c){if(D[a]){var d=E[a];d&&d.onMessageSetFavorite(b,c)}}function p(b,c){c==a.Global.user().user_id&&i(b,0);var d=E[b];d&&d.onUnseenCleared(c)}function q(a){e()}function r(a,b){D[a]&&(D[a].name=b,s(a)),E[a]&&E[a].onNameEdited(b)}function s(b){var c=a.Chat.chatAvatar(D[b]),d=$(a.Templates.Chat.chatListItem({chat:D[b],avatar:c,days_until_old:F})),e=C.find('.chat-list-item[data-chat="'+b+'"]');e.is(".active")&&d.addClass("active"),a.Global.viewLoaded(e.replaceWith(d))}function t(a,b,c){D[a]&&(D[a].users=c,s(a)),E[a]&&E[a].onUsersAdded(b,c)}function u(a,b,c){D[a]&&(D[a].users=c,s(a)),E[a]&&E[a].onUsersRemoved(b,c)}function v(a){this.onChatDisabled(a)}function w(a){D[a]&&(C.find('.chat-list-item[data-chat="'+a+'"]').remove(),delete D[a]);var b=E[a];b&&(b.remove(),delete E[a])}function x(a,b){var c=E[a];c&&c.onUserStartedTyping(b)}function y(a,b){var c=E[a];c&&c.onUserStoppedTyping(b)}function z(){a.Global.getFocus(a.Global.trans("chat.focus_message"))}function A(){var a=!!C.find(".chat-list-item.chat-old").length;C.find(".chat-toggle-old").toggle(a)}var B,C,D,E,F=30;b.init=c,b.isChatActive=j,b.openChat=k,b.onNewMessage=l,b.onMessageEdited=m,b.onMessageDeleted=n,b.onMessageSetFavorite=o,b.onUnseenCleared=p,b.onChatCreated=q,b.onNameEdited=r,b.onUsersAdded=t,b.onUsersRemoved=u,b.onChatLeft=v,b.onChatDisabled=w,b.onUserStartedTyping=x,b.onUserStoppedTyping=y,b.getFocus=z;var G;!function(b){function c(){j=!1,f();var a=C.find("#chat-menu-contacts");i=a.find(".chat-menu-search"),e()}function d(a){j=a,C.find(".chat-multiple-contact").toggleClass("hidden",j),C.find(".chat-create-chat").toggleClass("hidden",!j),C.find("#chat-menu-contacts .contact-select").toggleClass("hidden",!j)}function e(){C.on("click",".chat-multiple-contact",function(){b.setGroupMode(!0)}).on("change",".chat-contact label",function(){if(j){var a=C.find("#chat-menu-contacts .chat-contact input:checked").length;C.find(".chat-create-chat").prop("disabled",!a),i.val("").trigger("keyup")}else{var b=$(this).closest(".chat-contact");h([b.data("user")],!0,b.find(".user-name"))}}).on("click",".chat-create-chat",function(){var a=$(this);h(C.find("#chat-menu-contacts .chat-contact input:checked").map(function(){return $(this).closest(".chat-contact").data("user")}).get(),!1,a)}),i.on("keyup",function(){var b=$(this).val(),c=C.find(".chat-contacts");a.Util.updateSearchFilterForList(b,c)})}function f(){var b=$("#chat-menu-contacts"),c=b.find(".chat-contacts"),d=a.Global.fellowUsers(),e="";for(var f in d)if(d.hasOwnProperty(f)){var g=d[f];e+=a.Templates.Chat.chatContactItem({user:g})}a.Global.viewLoaded(c.html(e))}function h(c,d,e){if(c=c.filter(function(b){return b!=a.Global.user().user_id}),!c.length)return console.warn("create chat: no users provided"),!1;a.API.Chat.createChat(c,d,{onSuccess:function(c){var d=new a.API.Chat.Chat.CreateResponse(c);b.setGroupMode(!1),k(d.chat_id),i.val("").trigger("keyup"),C.find("#chat-menu-contacts .chat-contact input:checked").prop("checked",!1),g()},button:e})}var i,j;b.init=c,b.setGroupMode=d,b.createChat=h}(G=b.Contacts||(b.Contacts={}));var H;!function(b){function c(){i();var a=C.find("#chat-menu-channels");j=a.find(".chat-menu-search"),d()}function d(){C.on("click",".chat-channel",function(){f($(this).data("channel"),$(this).find(".channel-name"))}),j.on("keyup",function(){var b=$(this).val(),c=C.find(".chat-channels");a.Util.updateSearchFilterForList(b,c)})}function f(b,c){a.API.Chat.createChannel(b,{onSuccess:function(b){var c=new a.API.Chat.Chat.CreateChannelResponse(b),d=c.chat_id;e(function(){h(d),j.val("").trigger("keyup"),g()})},button:c})}function i(){var b=$("#chat-menu-channels"),c=b.find(".chat-channels"),d=a.Global.projectsByCategories(),e="";for(var f in d)if(d.hasOwnProperty(f)){var g=d[f];e+='<li class="chat-menu-section">'+g.name+"</li>";var h=g.projects;for(var i in h)if(h.hasOwnProperty(i)){var j=h[i],k=a.Chat.channelAvatar(j);e+=a.Templates.Chat.chatChannelItem({project:j,avatar:k})}}a.Global.viewLoaded(c.html(e))}var j;b.init=c,b.createChannel=f}(H=b.Channels||(b.Channels={}))}(b.Chat||(b.Chat={}))}(a.Script||(a.Script={}))}(App||(App={}));var App;!function(a){!function(b){!function(b){function c(b){a.Script.Chat.getFocus()}function d(b){var c=b.chat_id;a.Script.Chat.openChat(c),a.Script.Chat.getFocus()}function e(b){var c=b.project_id;a.Script.Chat.Channels.createChannel(c),a.Script.Chat.getFocus()}function f(b){var c=b.users;a.Script.Chat.Contacts.createChat(c,!0),a.Script.Chat.getFocus()}b.onOpen=c,b.onOpenChat=d,b.onOpenChannel=e,b.onOpenGroup=f}(b.Chat||(b.Chat={}))}(a.InternalMessaging||(a.InternalMessaging={}))}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){!function(b){!function(c){function d(b){a.Global.onUserAdded(b),a.Notifications.notifyWithUser(a.Global.trans("user.new",{user:b.display_name}),b.user_id)}var e=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.shouldProcessOnlyForCurrentProject=function(){return!1},b.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},b}(b.Action);c.MainAction=e;!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){var d=b.popup_id,e=$("#"+d);e.length?a.Popup.hide(e):console.warn("Popup to close was not found: "+d)},c}(e);b.closePopup=c;var d=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){var d=b.message;b.blocking?a.Alert.show(d):a.Notifications.notify(d)},c}(e);b.sendMessage=d}(c.Session||(c.Session={}));!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){var d=b.project.project_id,e=b.user.user_id,f=Model.Project.getProject(d),g=!1;if((!f&&e==a.Global.user().user_id||f&&!f.hasUser(e))&&(g=!0),f)if(g){var h=b.user;e==a.Global.user().user_id?a.Global.addProject(b.project):Model.User.getUser(e)||a.Push.Main.onNewFellowUser(h);var i=e===a.Global.user().user_id?a.Global.trans("project.you_added",{project:f.name}):a.Global.trans("project.user_added",{user:h.display_name,project:f.name});a.Notifications.notifyWithUser(i,e),a.Global.onUserAddedToProject(e,b.project_auth)}else a.Global.onUserAuthEditedForProject(e,b.project_auth.auth,d)},c}(e);b.editUserProjectAuth=c;var d=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onCategoryEdited(b.category)},c}(e);b.editCategory=d}(c.Account||(c.Account={}));!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectCreated(b.project)},c}(e);b.create=c;var d=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectEdited(b.project)},c}(e);b.update=d;var f=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectEdited(b.project)},c}(e);b.activateModules=f;var g=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectEdited(b.project)},c}(e);b.deactivateModules=g;var h=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.ensureTag(b.tag),a.Global.onProjectTagAdded(b.project_id,b.tag)},c}(e);b.addTag=h;var i=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectTagRemoved(b.project_id,b.tag)},c}(e);b.removeTag=i;var j=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectTagRemoved(b.project_id,b.tag)},c}(e);b.removeTagByLabel=j;var k=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onUsersRemovedFromProject(b.user_id_list,b.project_id)},c}(e);b.removeUsers=k;var l=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectEdited(b.project)},c}(e);b.archive=l;var m=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectEdited(b.project)},c}(e);b.restore=m;var n=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.onProjectDeleted(b.project_id)},c}(e);b.delete_impl=n}(c.Project||(c.Project={}));!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){a.Global.removeTag(b.tag.tag_id)},c}(e);b.remove=c;var d=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.onMessage=function(b,c){b.tags.forEach(function(b){a.Global.removeTag(b.tag_id)})},c}(e);b.batchRemove=d}(c.Tag||(c.Tag={}));!function(b){var c=function(c){function d(){c.apply(this,arguments)}return __extends(d,c),d.prototype.onMessage=function(c,d){var e=c.status,f=c.user_id,g=b.oUsersStatusTimers[f];g&&clearTimeout(g);var h=function(c){var d=Model.User.getUser(c);if(d){var f=!("offline"!==d.status||"offline"===e),g=d.user_id==a.Global.user().user_id;f&&!g&&a.Notifications.notifyWithUser(a.Global.trans("user.connected",{user:"<b>"+d.display_name+"</b>"}),d.user_id),a.Global.setUserStatus(c,e),b.oUsersStatusTimers[c]=null,delete b.oUsersStatusTimers[c]}};"offline"==e?b.oUsersStatusTimers[f]=setTimeout(function(){h(f)},b.iUserOfflineDelay):h(f)},d}(e);b.status=c,b.oUsersStatusTimers={},b.iUserOfflineDelay=2e3}(c.User||(c.User={})),c.onNewFellowUser=d}(b.Main||(b.Main={}))}(a.Push||(a.Push={}))}(App||(App={}));