{% extends 'ObservationBundle::layout.mobile.html.twig' %}
{% block title %}Observation{% endblock %}

{% form_theme form 'ObservationBundle:Form:locationField.html.twig' %}


{% block content %}
    <div id="contentAdd">
        <div id="flash">{% for flash_message in app.session.flashBag.get('success') %}
                <div class="alert alert-{{ type }}" id="flashMobile">
                    <strong>{{ flash_message }}</strong>
                </div>
            {% endfor %}
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                {% if app.session.get('getBird') == true %}
                    <h1>{{ bird.LbNom }}</h1>
                {% else %}
                    <h1>Saisir une observation</h1>
                {% endif %}
            </div>
            <div class="panel-body">
                {{ form_start(form, {'attr': {'class': 'form-horizontal', 'enctype': 'multipart/form-data'}}) }}
                {{ form_errors(form) }}

                {#Localisation Observation#}
                <div class="form-group">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            {{ form_label(form.location) }}
                            {{ form_errors(form.location) }}
                            {{ form_widget(form.location, {'attr':{'class': 'col-xs-12'}}) }}
                            <button type="button" class="btn btn-nao" id="locationChoice">
                                Selectioner votre position
                            </button>
                        </div>
                    </div>
                </div>
                {#Modale de la map#}
                <div class="modal fade" id="myModal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Lieu de l'observation</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true" class="glyphicon glyphicon-remove"></span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div id="map"></div>
                            </div>
                            <div class="modal-footer">
                                <span id="infoPosition"></span>
                                <button type="button" class="btn btn-primary col-xs-offset-1" id="currentPosition"
                                        data-dismiss="modal">Valider la position
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {#Date de l'observation#}
                <div class="form-group">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1 col-xs-offset-1">
                            {{ form_label(form.seeAt, form.vars.label) }}
                            {{ form_errors(form.seeAt) }}
                            {{ form_widget(form.seeAt, { 'id': 'datepicker'}) }}
                        </div>
                    </div>
                </div>
                {#Choix de l'oiseau#}
                {% if app.session.get('getBird') == false %}
                    <div class="form-group">
                        <div class="row">
                            <div class="col-xs-10 col-xs-offset-1">
                                {{ form_label(form.bird, form.vars.label) }}
                                {{ form_errors(form.bird) }}
                                {{ form_widget(form.bird) }}
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if app.session.get('getBird') == true %}
                    <div style="display: none" id="getBird">
                        {{ form_label(form.bird, form.vars.label) }}
                        {{ form_errors(form.bird) }}
                        {{ form_widget(form.bird) }}
                    </div>
                {% endif %}
                {#Nombre de spécimens observés#}
                <div class="form-group">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            {{ form_label(form.quantity, form.vars.label) }}
                            {{ form_errors(form.quantity) }}
                            {{ form_widget(form.quantity, {'type': 'number'}) }}
                        </div>
                    </div>
                </div>
                {#Ajout de Photos#}
                <div class="form-group">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            <div class="col-xs-12">
                                {{ form_label(form.pictures) }}
                                {{ form_errors(form.pictures) }}
                            </div>
                            <div class="col-xs-4">
                                {{ form_widget(form.pictures.first, {'attr': {'data-buttonText': 'Choisir Photo(s)'}}) }}
                            </div>
                            <div class="col-xs-4">
                                {{ form_widget(form.pictures.second, {'attr': {'data-buttonText': 'Prendre Photo(s)', 'capture': 'true'}}) }}
                            </div>
                            <br>
                            <div id="picBird" class="col-xs-12">
                                <button type="button" class="close" aria-label="Close" id="closePic" hidden>
                                    <span aria-hidden="true" class="glyphicon glyphicon-remove"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {#AJout d'une observation#}
                <div class="form-group">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1">
                            {{ form_label(form.observation) }}
                            {{ form_errors(form.observation) }}
                            {{ form_widget(form.observation) }}
                        </div>
                    </div>
                    <p class="col-xs-offset-1">* Champs Obligatoires</p>
                </div>
                {#Soumission du formulaire#}
                <div class="form-group text-center">
                    <div class="col-xs-10 col-xs-offset-1">
                        {{ form_widget(form.save, {'attr':{'class': 'btn-nao'}}) }}
                    </div>
                </div>
                {{ form_end(form) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script src="{{ asset('bundles/observation/js/Maps/observation.add.js') }}"></script>
    <script src="{{ asset('bundles/observation/js/observation.js') }}"></script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?v=3&amp;key={{ google_api_key }}&callback=initMap&libraries=places">
    </script>
{% endblock %}











